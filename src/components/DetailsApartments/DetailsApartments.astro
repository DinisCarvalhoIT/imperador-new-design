---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
import { Image, getImage } from "astro:assets";
import type { ImageMetadata } from "astro";
import InteractiveBuilding from "./InteractiveBuilding";
import WhatsAppButton from "./WhatsAppButton";

// Import all apartment model images
import t1ModeloA from "../../../public/detailsApartments/T1_modeloA.png";
import t1ModeloB from "../../../public/detailsApartments/T1_modeloB.png";
import t1ModeloC from "../../../public/detailsApartments/T1_modeloC.png";
import t2ModeloA from "../../../public/detailsApartments/T2_modeloA.png";
import t2ModeloB from "../../../public/detailsApartments/T2_modeloB.png";
import t3ModeloA from "../../../public/detailsApartments/T3_modeloA.png";
import t3ModeloB from "../../../public/detailsApartments/T3_modeloB.png";
import detailsBgImage from "../../../public/detailsApartments/details-apartments.jpg";
import detailsBgMobileImage from "../../../public/detailsApartments/details-apartments-mobile.jpg";
import detailsBgTabletImage from "../../../public/detailsApartments/details-apartments-tablet.jpg";
import dotSvg from "../../../public/detailsApartments/dot.svg";

// Process images with getImage - optimize and convert to webp
const processImage = async (image: ImageMetadata) => {
  const processed = await getImage({
    src: image,
    format: "webp",
    quality: 90,
  });
  return processed.src;
};

// Process all images
const apartmentImageUrls = {
  "T1-0": await processImage(t1ModeloA),
  "T1-1": await processImage(t1ModeloB),
  "T1-2": await processImage(t1ModeloC),
  "T2-0": await processImage(t2ModeloA),
  "T2-1": await processImage(t2ModeloB),
  "T3-0": await processImage(t3ModeloA),
  "T3-1": await processImage(t3ModeloB),
};

// Process background images
const processedBgImage = await getImage({
  src: detailsBgImage,
  format: "webp",
  width: 1920,
  height: 1080,
  quality: 90,
});
const processedBgMobileImage = await getImage({
  src: detailsBgMobileImage,
  format: "webp",
  width: 1000,
  height: 1000,
  quality: 90,
});

// Process dot SVG - for SVGs we can just get the src directly
const dotSvgUrl = dotSvg.src;
---

<section class="relative w-full">
  <div
    class="relative w-full h-full overflow-hidden bg-cover bg-center bg-no-repeat"
    style=`background-image: linear-gradient(rgba(11, 29, 38, 0.94), rgba(11, 29, 38, 0.94)), url('${processedBgImage.src}');`
  >
    <div class="flex justify-center items-center h-full">
      <div class="relative">
        <!-- Desktop Image - Hidden on mobile -->
        <Image
          src={detailsBgImage}
          alt={t("details_apartments.image_alt")}
          class="hidden lg:block max-w-[1680px] w-full h-auto object-contain rounded-lg shadow-2xl"
          width={1920}
          format="webp"
          height={1080}
        />
        <Image
          src={detailsBgTabletImage}
          alt={t("details_apartments.image_alt")}
          class="hidden sm:block lg:hidden max-w-[1680px] w-full h-auto object-contain rounded-lg shadow-2xl"
          width={1200}
          format="webp"
          height={1400}
        />
        <!-- Mobile Image - Hidden on desktop -->
        <Image
          src={detailsBgMobileImage}
          alt={t("details_apartments.image_alt")}
          class="block sm:hidden max-w-[1680px] w-full h-auto object-contain rounded-lg shadow-2xl"
          width={1200}
          format="webp"
          height={1400}
        />
        
        <div class="absolute inset-0 px-6 sm:px-8 lg:px-12 flex z-10">
          <div
            class="flex-1 flex flex-col items-center justify-start pt-12 sm:pt-7 lg:pt-10 xl:pt-14 pb-8 sm:pb-10"
          >
            <div
              class="font-montserrat text-sm xl:text-lg uppercase text-[#E7C873] font-medium tracking-widest lg:tracking-[6px] leading-[1.3] mb-2 sm:mb-3 lg:mb-3"
            >
              {t("details_apartments.tagline")}
            </div>
            <div
              class="font-playfairDisplay text-4xl md:text-4xl lg:text-5xl text-pretty leading-none lg:leading-[34px] text-white text-center px-2 mb-0"
            >
              {t("details_apartments.title")}
            </div>
          </div>
        </div>
        <InteractiveBuilding client:load lang={lang} apartmentImages={apartmentImageUrls} dotSvgUrl={dotSvgUrl} />
        
        <!-- WhatsApp Button - Bottom Middle -->
        <div class="absolute md:bottom-[4%] bottom-[5%]  left-1/2 -translate-x-1/2 z-20 pb-6 sm:pb-8 lg:pb-10">
          <WhatsAppButton text={t("details_apartments.prices_availability")} client:load />
        </div>
      </div>
    </div>
  </div>
</section>
