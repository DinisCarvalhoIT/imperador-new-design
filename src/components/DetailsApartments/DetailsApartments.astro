---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
import { Image, getImage } from "astro:assets";
import type { ImageMetadata } from "astro";
import InteractiveBuilding from "./InteractiveBuilding";

// Import all apartment model images
import t1ModeloA from "../../../public/detailsApartments/T1_modeloA.png";
import t1ModeloB from "../../../public/detailsApartments/T1_modeloB.png";
import t1ModeloC from "../../../public/detailsApartments/T1_modeloC.png";
import t2ModeloA from "../../../public/detailsApartments/T2_modeloA.png";
import t2ModeloB from "../../../public/detailsApartments/T2_modeloB.png";
import t3ModeloA from "../../../public/detailsApartments/T3_modeloA.png";
import t3ModeloB from "../../../public/detailsApartments/T3_modeloB.png";
import detailsBgImage from "../../../public/detailsApartments/details-apartments.png";
import detailsBgMobileImage from "../../../public/detailsApartments/details-apartments-mobile.png";
import dotSvg from "../../../public/detailsApartments/dot.svg";

// Process images with getImage - optimize and convert to webp
const processImage = async (image: ImageMetadata) => {
  const processed = await getImage({
    src: image,
    format: "webp",
    quality: 90,
  });
  return processed.src;
};

// Process all images
const apartmentImageUrls = {
  "T1-0": await processImage(t1ModeloA),
  "T1-1": await processImage(t1ModeloB),
  "T1-2": await processImage(t1ModeloC),
  "T2-0": await processImage(t2ModeloA),
  "T2-1": await processImage(t2ModeloB),
  "T3-0": await processImage(t3ModeloA),
  "T3-1": await processImage(t3ModeloB),
};

// Process background images
const processedBgImage = await getImage({
  src: detailsBgImage,
  format: "webp",
  quality: 90,
});
const processedBgMobileImage = await getImage({
  src: detailsBgMobileImage,
  format: "webp",
  quality: 90,
});

// Process dot SVG - for SVGs we can just get the src directly
const dotSvgUrl = dotSvg.src;
---

<section class="relative w-full">
  <div
    class="relative w-full h-full overflow-hidden bg-cover bg-center bg-no-repeat"
    style={`background-image: linear-gradient(rgba(11, 29, 38, 0.94), rgba(11, 29, 38, 0.94)), url('${processedBgImage.src}');`}
  >
    <div class="flex justify-center items-center h-full">
      <div class="relative">
        <picture>
          <source
            srcset={processedBgMobileImage.src}
            media="(max-width: 1023px)"
          />
          <Image
            src={detailsBgImage}
            alt={t("details_apartments.image_alt")}
            class="max-w-[1680px] w-full h-auto object-contain rounded-lg shadow-2xl"
            width={1920}
            format="webp"
            height={1080}
          />
        </picture>

        <div class="absolute inset-0 px-6 lg:px-12 flex z-10">
          <div
            class="flex-1 flex flex-col items-center justify-start pt-12 lg:pt-10 xl:pt-14"
          >
          <div
            class="font-montserrat text-[10px] lg:text-base uppercase text-[#E7C873] font-medium tracking-widest lg:tracking-[6px] leading-[14px] lg:leading-[22px]"
          >
            {t("details_apartments.tagline")}
          </div>
          <div
            class="font-playfairDisplay text-[28px] leading-[32px] lg:text-[58px] text-pretty lg:leading-[68px] text-white text-center"
          >
            {t("details_apartments.title")}
          </div>
          </div>
        </div>

        <InteractiveBuilding client:load lang={lang} apartmentImages={apartmentImageUrls} dotSvgUrl={dotSvgUrl} />
      </div>
    </div>
  </div>
</section>
