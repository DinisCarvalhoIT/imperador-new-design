---
import { getLangFromUrl } from "@/i18n/utils";
import { getImage } from "astro:assets";
import SynchronizedCarousels from "./SynchronizedCarousels";
import { getModelIndexFromUrl } from "@/data/apartmentModels";

interface ApartmentDetail {
  id: string;
  apartmentImage: string;
  mainTitleKey: string;
  subTitleKey: string;
  features: {
    titleKey: string;
    descriptionKey?: string;
  }[];
}

interface FloorPlanItem {
  id: string;
  floorPlanImage: string;
  smallImageCollumnTable: boolean;
  smallImageStyle: string;
  smallFloorPlanImage: string;
  tableImagePT: string;
  tableImageEN: string;
  tableImageStyle: string;
  mainTitleKey: string;
  mobileTitleKey: string;
  mobileSelectorKey: string;
  subTitleKey: string;
}

interface Props {
  apartmentDetailsData: ApartmentDetail[];
  floorPlansData: FloorPlanItem[];
}

const { apartmentDetailsData, floorPlansData } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const initialIndex = getModelIndexFromUrl(Astro.url.searchParams);

// Import and process background images
import detailsBgImage from "../../../public/detailsApartments/details-apartments.png";
import floorPlansBgImage from "../../../public/FloorPlans/Rectangle 34624212.png";
import checkIcon from "../../../public/Check.svg";

const processedDetailsBg = await getImage({
  src: detailsBgImage,
  format: "webp",
  quality: 90,
});

const processedFloorPlansBg = await getImage({
  src: floorPlansBgImage,
  format: "webp",
  quality: 90,
});

// Process check icon SVG
const checkIconUrl = checkIcon.src;
---

<SynchronizedCarousels
  lang={lang}
  apartmentDetailsData={apartmentDetailsData}
  floorPlansData={floorPlansData}
  initialIndex={initialIndex}
  detailsBackgroundImage={processedDetailsBg.src}
  floorPlansBackgroundImage={processedFloorPlansBg.src}
  checkIconUrl={checkIconUrl}
  client:load
/>

